#include "header.html"
<table>
#if $sum
    #set $factor=len($tasks)
#else
    #set $factor=1
#end if
<tr><td class="title"></td><td class="title"></td>
    #for $i in $groups.year
        <td class="legend" colspan="$i[1]"><span><a href="#" class="hasTooltip">$i[0]<span>$int(round((i[2]/i[1])*100))%
        #if i[1] != i[2]
            <small>$int(round($factor*(i[1]-i[2]))) days free</small>
        #end if
        </span></a></span></td>
    #end for
</tr>
<tr><td class="title"></td><td class="title"></td>
    #for $i in $groups.month
        <td class="legend" colspan="$i[1]"><a href="#" class="hasTooltip">$i[0]<span>$int(round((i[2]/i[1])*100))%
        #if i[1] != i[2]
            <small>$round($factor*(i[1]-i[2]), 1) days free</small>
        #end if
        </span></a></td>
    #end for
</tr>
<tr><td class="title"></td><td class="title"></td>
    #for $i in $dates
        <td class="legend tiny" style="border-left-color: $i[1];"><div style="width: 1.1em">$i[0].day</div></td>
    #end for
</tr>
<tr><td class="title light">total</td><td class="title light">$len($slots)</td>
    #for $i in $slots
        <td class="slot total" style="border-left-color: $i[1];" bgcolor="$i[0][1]"><a href="#" class="hasTooltip">&nbsp;&nbsp;<span>$int(round(i[0][0]*100))%</span></a></td>
    #end for
</tr>
#set previous=None
#for $t in $tasks
<tr>
    #if (round($t[3],3) != round($t[2],3))
        #set $highlight = 'overflow'
    #else
        #set $highlight = ''
    #end if
    <td class="title $highlight">
    #set arrow=''
    #set before=''
    #if $t[0] in $collapse
        #set before='<a href="'+$url+'?x='+$t[0]+'">'
        #set arrow='<span class="button">&nbsp;&or;</span></a>'
    #end if
    #if $t[5] in $expand
        #if not $t[5]==previous
            #set arrow='<span class="button">&nbsp;<a class="light" href="'+$url+'">&and;</a></span>'
        #else
            #set arrow='<span class="button">&nbsp;&nbsp;</span>'
        #end if
    #end if
    #set previous = $t[5]
    #set supertask = ('supertask' in $t[4] and $t[4]['supertask'])
    #if 'url' in $t[4]
        <a target="_blank" class="$highlight" href="$t[4]['url']?c=1">$t[0]</a>$arrow
    #else
        $before$t[0]$arrow
    #end if
    </td><td class="title light">
    #if $t[2] > 0
        $round($t[2],1)
    #end if
    </td>
    #for $i in $t[1]
        <td class="slot" style="border-left-color: $i[1];" bgcolor="$i[0][1]">
            #if ($i[0][0] > 0.0)
                <a href="#" class="hasTooltip">&nbsp;&nbsp;<span>$int(round(i[0][0]*100))% <small>on $t[0]</small>
                #if (round($t[3],3) != round($t[2],3))
                    but lacks $round(t[2]-t[3], 1) days!
                #end if
                </span></a>
            #end if
        </td>
    #end for
</tr>
#end for
<tr><td class="title">
#if not $sum
    <form action="$add/?c=0" target="_blank" method="POST" name="new">
        <input size="6" type="text" name="name" value=""></input>
        <input type="submit" value="+"></input>
    </form>
    <script>document.new.name=""</script>
#end if
</td><td class="title"></td>
    #for $i in $groups.week
        <td class="legend week" colspan="$i[1]"><a href="#" class="hasTooltip">$i[0]<span>$int(round((i[2]/i[1])*100))%
        #if i[1] != i[2]
            <small>$round($factor*(i[1]-i[2]), 1) days free</small>
        #end if
        </span></a></td>
    #end for
</tr>
</table>
#include "footer.html"
